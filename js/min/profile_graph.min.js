function ProfileGraph(a){var b={Points:"points",Goals:"goals",Price:"price",Assists:"assists","Net transfers":"netTransfers","Clean sheets":"cleanSheets","Minutes played":"minutesPlayed",Others:"othersBreakdown","Goals breakdown":"goalsBreakdown","Assists breakdown":"assistsBreakdown","Clean sheets breakdown":"cleanSheetsBreakdown"};this.ID_ATTR_MAP=function(b){var a={},c;for(c in b)a[b[c]]=c;return a}(b);for(var d in b)a.series.push({name:d,id:b[d],type:"line",pointStart:1,showInLegend:!1});this.initOptions=
a;Highcharts.setOptions({lang:{loading:'Tick one of the checkboxes next to "Active" in the options above then click "Update Graph" to begin!'}});this.graph=new Highcharts.Chart(a);this.graph.showLoading();this.data={points:Array(38),price:Array(38),goals:Array(38),assists:Array(38),netTransfers:Array(38),minutesPlayed:Array(38)};0!==$("#cleanSheets").length&&(this.data.cleanSheets=Array(38));var c=this.data;Object.keys(this.data).forEach(function(b){b=c[b];for(var a=0;a<b.length;a++){b[a]=Array(38);
for(var d=0;d<b[a].length;d++)b[a][d]={over_time:void 0,home_vs_away:void 0,consistency:void 0,cum_total:void 0,events_breakdown:void 0,changes:void 0}}})}
ProfileGraph.prototype.update=function(a,b){var d=this.isValid();toggleAlertBox(d);if(d){this.graph.series.forEach(function(b){b.setData([],!1);b.update({showInLegend:!1});b.show()});var c=this;$("div.performance_metrics").hasClass("hidden")||0===$("input[type=checkbox]:checked").length||$("div.performance_metrics > .form-group").each(function(){var e=$("select.form-control",this).val().split("-"),d=e[0],e=e[1];0!==$("input[type=checkbox]:checked",this).length&&(c.graph.showLoading("Loading graph..."),
c.graph.setTitle({text:null},{text:"Click on any of the keys in the legend to toggle its corresponding graph line/bar's visibility"},!1),"over_time"===e&&"cleanSheets"===d||"changes"===e?c.drawBarGraph(d,e,a,b):"over_time"===e||"cum_total"===e?c.drawLineGraph(d,e,a,b):"home_vs_away"===e?c.drawPieChart(d,e,a,b):"consistency"===e?c.drawBoxPlot(d,e,a,b):"events_breakdown"===e&&c.drawCompoundBarGraph(d,e,a,b),c.graph.hideLoading())})}};
ProfileGraph.prototype.drawLineGraph=function(a,b,d,c){b=this.getData(a,b,d,c);"price"===a?this.graph.get(a).update({data:b,pointStart:1,type:"line",tooltip:{headerFormat:"",pointFormatter:function(){return"Week "+Math.floor(this.x)+"<br><b>Price:</b> \u00a3"+this.y+"M"}},showInLegend:!0},!1):this.graph.get(a).update({data:b,pointStart:1,type:"line",tooltip:"points"===a?{headerFormat:"{point.key}<br>",pointFormatter:function(){return"Week "+Math.floor(this.x)+"<br><b>"+this.series.name+": </b>"+this.y}}:
{headerFormat:"",pointFormatter:function(){return"Week "+Math.floor(this.x)+"<br><b>"+this.series.name+": </b>"+this.y}},showInLegend:!0},!1);this.graph.xAxis[0].update({categories:null,visible:!0,title:{text:"Game weeks"}},!1);this.graph.yAxis[0].update({visible:!0},!1);this.graph.redraw()};
ProfileGraph.prototype.drawPieChart=function(a,b,d,c){b=this.getData(a,b,d,c);this.graph.get(a).update({data:b,type:"pie",tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormatter:function(){var b,a;a=this.series.data;a[0].percentage>a[1].percentage?(b=a[0].name,a=Math.round(a[0].percentage)):(b=a[1].name,a=Math.round(a[1].percentage));return this.name===b?"<span>"+a+"%</span>":"<span>"+(100-a)+"%</span>"}},showInLegend:!1},!1);b=this.ID_ATTR_MAP;this.graph.xAxis[0].update({visible:!1},!1);
this.graph.yAxis[0].update({visible:!1},!1);this.graph.setTitle({text:b[a]+" at Home vs Away"});this.graph.redraw()};
ProfileGraph.prototype.drawBoxPlot=function(a,b,d,c){b=this.getData(a,b,d,c);this.graph.get(a).update({data:b,type:"boxplot",pointStart:1,tooltip:{headerFormat:"",pointFormatter:function(){return"<b>Min:</b> "+this.low+"<br><b>Lower Quartile:</b> "+this.q1+"<br><b>Median:</b> "+this.median+"<br><b>Upper Quartile:</b> "+this.q3+"<br><b>Max:</b> "+this.high}},showInLegend:!1},!1);this.graph.xAxis[0].update({visible:!1},!1);this.graph.yAxis[0].update({visible:!0},!1);this.graph.redraw()};
ProfileGraph.prototype.drawCompoundBarGraph=function(a,b,d,c){a=this.getData(a,b,d,c);var e=this.graph;a.forEach(function(a){var b=Object.getOwnPropertyNames(a)[0];e.get(b+"Breakdown").update({data:a[b],type:"column",tooltip:{headerFormat:"",pointFormatter:function(){var a=this.series.name.replace(" breakdown","");return"Week "+Math.floor(this.x)+"<br>Event:<b> "+a+"</b><br><b>Points:</b> "+this.y}},pointStart:1,showInLegend:!0},!1)});this.graph.xAxis[0].update({categories:null,visible:!0,title:{text:"Game weeks"}},
!1);this.graph.yAxis[0].update({visible:!0},!1);this.graph.redraw()};
ProfileGraph.prototype.drawBarGraph=function(a,b,d,c){b=this.getData(a,b,d,c);this.graph.get(a).update({data:b,type:"column",tooltip:"price"===a?{headerFormat:"",pointFormatter:function(){return"Week "+Math.floor(this.x)+"<br><b>Changes:</b> "+this.y+"M"}}:{headerFormat:"",pointFormatter:function(){return"Week "+Math.floor(this.x)+"<br><b>"+this.series.name+": </b>"+this.y}},pointStart:1,showInLegend:!0},!1);this.graph.xAxis[0].update({categories:null,visible:!0,title:{text:"Game weeks"}},!1);this.graph.yAxis[0].update({visible:!0},
!1);this.graph.redraw()};ProfileGraph.prototype.getData=function(a,b,d,c){var e=this.data[a][d-1][c-1];e[b]||$.ajax("/graph_data",{method:"POST",data:{attr:a,metric:b,start:d,end:c,player_name:$("img.img-responsive").attr("alt")},success:function(a){e[b]=a[b]},async:!1});return e[b]};
ProfileGraph.prototype.isValid=function(){var a=!0,b=[];$("div.performance_metrics:not(.hidden) > .form-group select.form-control").each(function(){var a=$(this).val().split("-");b.push(a)});for(var d={home_vs_away:"Home vs Away",consistency:"Consistency"},c=0;c<b.length;c++)1===$("input."+b[c][0]+"_switch[type=checkbox]:checked").length&&("home_vs_away"===b[c][1]||"consistency"===b[c][1])&&1<$("input[type=checkbox]:checked").length&&(a="home_vs_away"===b[c][1]?"home_vs_away":"consistency",a="<b>"+
d[a]+'</b> cannot be active at the same time with other options. Please uncheck the "Active" box next to other drop down menu(s) or uncheck the "Active" box next to the dropdown with <b>'+d[a]+"</b> selected before trying to update the graph.",$(".alert-danger").html('<span class="glyphicon glyphicon-alert"></span>&nbsp;&nbsp;'+a),a=!1);return a};
