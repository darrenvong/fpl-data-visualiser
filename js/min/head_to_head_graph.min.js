function HeadToHeadGraph(a){Highcharts.setOptions({lang:{loading:'Tick one of the checkboxes next to "Active" in the options above then click '+(500<window.innerWidth?'"Update Graph"':'<span class="glyphicon glyphicon-refresh"></span>')+" button to begin!"}});this.player1Name=$(".left figcaption").text();this.player2Name=$(".right figcaption").text();this.data={points:Array(38),goals:Array(38),assists:Array(38),cleanSheets:Array(38)};var d={Points:"points",Goals:"goals",Assists:"assists","Clean sheets":"cleanSheets"},
c=this,b;for(b in d)a.series.push({name:c.player1Name+"'s "+b,id:"player1_"+d[b],pointStart:1,showInLegend:!1}),a.series.push({name:c.player2Name+"'s "+b,id:"player2_"+d[b],pointStart:1,showInLegend:!1});a.series.push({id:"box",showInLegend:!1});this.initOptions=a;this.graph=new Highcharts.Chart(a);this.graph.showLoading();Object.keys(this.data).forEach(function(a){a=c.data[a];for(var b=0;b<a.length;b++){a[b]=Array(38);for(var d=0;d<a[b].length;d++)a[b][d]={player1:{box:null,other:null},player2:{box:null,
other:null}}}})}
HeadToHeadGraph.prototype.update=function(a,d){var c=this.isValid();toggleAlertBox(c);if(c){var c=$("div.attributes"),b=this;c.hasClass("hidden")||0===$("input[type=checkbox]:checked").length||(this.graph.showLoading("Loading graph..."),this.graph.series.forEach(function(a){a.setData([],!1);a.update({showInLegend:!1});a.show()}),$("input[type='radio']:checked",c).each(function(){var c=$(this),e=c.attr("name");0!==$("."+e+"_switch:checked").length&&(b.graph.setTitle({text:null},{text:"Click on the keys in the legend to toggle the visibility of their corresponding graph line/bar"},!1),
"line"===c.val()?b.drawLineGraph(e,a,d):"bar"===c.val()?b.drawBarGraph(e,a,d):b.drawBoxPlot(e,a,d))}),this.graph.hideLoading())}else $(".alert-danger").html('<span class="glyphicon glyphicon-alert"></span>&nbsp;&nbsp;&nbsp;&nbsp;When "Box plot" is selected and the "Active" box of <b>Points</b> is checked, other "Active" boxes cannot be checked. Please either uncheck all of the other "Active" boxes, or deselect "Box plot" from <b>Points</b> to continue.')};
HeadToHeadGraph.prototype.updateData=function(a,d,c,b){if("consistency"===b){var f=this.data[a][d-1][c-1].player1,e=this.data[a][d-1][c-1].player2;if(f.box&&e.box)return}else if(f=this.data[a][d-1][c-1].player1,e=this.data[a][d-1][c-1].player2,f.other&&e.other)return;$.ajax("/graph_data",{method:"POST",data:{attr:a,metric:b,start:d,end:c,player_name:$(".left img").attr("alt")},async:!1,success:function(a){"consistency"===b?f.box=a[b][0]:f.other=a[b]}});$.ajax("/graph_data",{method:"POST",data:{attr:a,
metric:b,start:d,end:c,player_name:$(".right img").attr("alt")},async:!1,success:function(a){"consistency"===b?e.box=a[b][0]:e.other=a[b]}})};
HeadToHeadGraph.prototype.drawLineGraph=function(a,d,c){this.updateData(a,d,c,"over_time");var b=this.data;this.graph.get("player1_"+a).update({data:b[a][d-1][c-1].player1.other,pointStart:1,type:"line",showInLegend:!0},!1);this.graph.get("player2_"+a).update({data:b[a][d-1][c-1].player2.other,pointStart:1,type:"line",showInLegend:!0},!1);this.graph.xAxis[0].update({categories:null,title:{text:"Game weeks"},visible:!0},!1);this.graph.yAxis[0].update({visible:!0},!1);this.graph.redraw()};
HeadToHeadGraph.prototype.drawBarGraph=function(a,d,c){this.updateData(a,d,c,"over_time");var b=this.data;this.graph.get("player1_"+a).update({data:b[a][d-1][c-1].player1.other,pointStart:1,type:"column",showInLegend:!0},!1);this.graph.get("player2_"+a).update({data:b[a][d-1][c-1].player2.other,pointStart:1,type:"column",showInLegend:!0},!1);this.graph.xAxis[0].update({categories:null,title:{text:"Game weeks"},visible:!0},!1);this.graph.yAxis[0].update({visible:!0},!1);this.graph.redraw()};
HeadToHeadGraph.prototype.drawBoxPlot=function(a,d,c){this.updateData(a,d,c,"consistency");var b=this.data,f=this.player1Name,e=this.player2Name;this.graph.get("box").update({data:[b[a][d-1][c-1].player1.box,b[a][d-1][c-1].player2.box],pointStart:1,type:"boxplot",showInLegend:!1},!1);this.graph.xAxis[0].update({categories:[null,f,e],title:{text:"Players"},visible:!0},!1);this.graph.yAxis[0].update({visible:!0},!1);this.graph.redraw()};
HeadToHeadGraph.prototype.isValid=function(){var a=!1,d=!0;$("input[type='radio']:checked").each(function(){var c=$(this),b=c.attr("name"),b=1===$("."+b+"_switch:checked").length?!0:!1;if(!d)return!1;"box"===c.val()&&b?a=!0:b&&a&&(d=!1)});return d};
